<!DOCTYPE html>
<html>
<head>
	<title>Leaflet.draw vector editing handlers</title>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>

  <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
  <script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>

	<script src="http://leaflet.github.io/Leaflet.draw/leaflet.draw.js"></script>
	<link rel="stylesheet" href="http://leaflet.github.io/Leaflet.draw/leaflet.draw.css" />


  <script src="http://rawgithub.com/kartena/Proj4Leaflet/master/lib/proj4-compressed.js"></script>
  <script src="http://rawgithub.com/kartena/Proj4Leaflet/master/src/proj4leaflet.js"></script>

  <script src="L.Control.MousePosition.js"></script>
  <link rel="stylesheet" href="L.Control.MousePosition.css" />

  <script src="leaflet.groupedlayercontrol.js"></script>
  <link rel="stylesheet" href="leaflet.groupedlayercontrol.css" />

    <!-- Bootstrap -->
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">

    <link rel="stylesheet" href="http://nakupanda.github.io/bootstrap3-dialog/assets/bootstrap-dialog/css/bootstrap-dialog.min.css">

  <script src="http://builds.handlebarsjs.com.s3.amazonaws.com/handlebars-v3.0.0.js"></script>

  <script src="template.js"></script>

<script id="form-template" type="text/x-handlebars-template">
  <form class="form-horizontal">
    <fieldset>
      <!-- Text input-->
      <div class="form-group">
        <label class="col-md-4 control-label" for="textinput">Name</label>
        <div class="col-md-8">
          <input id="textinput" name="name" type="text" placeholder="" class="form-control input-md">
        </div>
      </div>
      <!-- Text input-->
      <div class="form-group">
        <label class="col-md-4 control-label" for="textinput">Email</label>
        <div class="col-md-8">
          <input id="textinput" name="email" type="text" placeholder="" class="form-control input-md">
        </div>
      </div>
      <!-- Text input-->
      <div class="form-group">
        <label class="col-md-4 control-label" for="textinput">Latitude</label>
        <div class="col-md-8">
          <input id="textinput" name="lat" type="text" placeholder="" class="form-control input-md" value="{{lat}}">
        </div>
      </div>
      <!-- Text input-->
      <div class="form-group">
        <label class="col-md-4 control-label" for="textinput">Longitude</label>
        <div class="col-md-8">
          <input id="textinput" name="lon" type="text" placeholder="" class="form-control input-md" value="{{lng}}">
        </div>
      </div>
      <!-- Textarea -->
      <div class="form-group">
        <label class="col-md-4 control-label" for="textarea">Report Details</label>
        <div class="col-md-8">
          <textarea class="form-control" id="textarea" name="report"></textarea>
        </div>
      </div>
      <!-- Button -->
      <div class="form-group">
        <label class="col-md-8 control-label" for="singlebutton"></label>
        <div class="col-md-4">
          <button type="submit" class="btn btn-primary">Generate Report</button>
        </div>
      </div>
    </fieldset>
  </form>
</script>

    <style>
      html, body {
      margin: 0;
      height: 100%;
      }
      fieldset { width:480px; }
    </style>

</head>
<body>
	<div id="map" style="width: 100%; height: 100%; border: 1px solid #ccc"></div>

	<script>
  var crs = new L.Proj.CRS.TMS(
    'EPSG:3005',
    '+proj=aea +lat_1=50 +lat_2=58.5 +lat_0=45 +lon_0=-126 +x_0=1000000 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs',
    [-1000000, -1000000, 3000000, 3000000],
    { 
      resolutions: [7812.5, 3906.25, 1953.125, 976.5625, 488.28125, 244.140625, 122.0703125, 61.03515625, 30.517578125, 15.2587890625, 7.62939453125, 3.814697265625]
    }
  );

  var map = new L.Map('map', 
    {
      crs: crs,
      center: new L.LatLng(55, -125), 
      zoom: 2,
      maxBounds: L.latLngBounds([[45, -148], [62, -108]]),
      worldCopyJump: false
    }
    );

  var osm = L.tileLayer('http://{s}.tiles.pacificclimate.org/tilecache/tilecache.py/1.0.0/bc_osm/{z}/{x}/{y}.png', 
    {
      subdomains: 'abc',
      maxZoom: 12,
      noWrap: true,
      attribution: '&copy; <a href="http://openstreetmap.org/copyright">OpenStreetMap</a> contributors',
      continuousWorld: false
    }
    ).addTo(map);

  var pr = L.tileLayer.wms('http://atlas.pcic.uvic.ca/ncWMS/wms', {
    layers: 'pr_monClim_PRISM_historical_run1_197101-200012/pr',
    transparent: true,
    format: 'image/png',
    time: '1985-06-30',
    styles: 'boxfill/occam_inv',
    logscale: true,
    numcolorbands: 254,
  }).addTo(map);
  var tmax = L.tileLayer.wms('http://atlas.pcic.uvic.ca/ncWMS/wms', {
    layers: 'tmax_monClim_PRISM_historical_run1_197101-200012/tmax',
    transparent: true,
    format: 'image/png',
    time: '1985-06-30',
    styles: 'boxfill/ferret',
    logscale: false,
    numcolorbands: 254,
  });
  var tmin = L.tileLayer.wms('http://atlas.pcic.uvic.ca/ncWMS/wms', {
    layers: 'tmin_monClim_PRISM_historical_run1_197101-200012/tmin',
    transparent: true,
    format: 'image/png',
    time: '1985-06-30',
    styles: 'boxfill/ferret',
    logscale: false,
    numcolorbands: 254,
  });

  // var prismLayers = L.layerGroup([pr, tmax, tmin]).addTo(map);
  var groupedOverlays = {
    "PRISM Climatologies": {
      "Max Temp": tmax,
      "Min Temp": tmin,
      "Precip": pr,
    }
  };
  var options = { exclusiveGroups: ["PRISM Climatologies"] };
  L.control.groupedLayers(null, groupedOverlays, options).addTo(map);

  var drawnItems = L.featureGroup().addTo(map);

  L.control.mousePosition().addTo(map);

  map.addControl(new L.Control.Draw({
   edit: { featureGroup: drawnItems }
  }));

  var source   = $("#form-template").html();
  var template = Handlebars.compile(source);

  map.on('draw:created', function(event) {
    var type = event.layerType;
    var layer = event.layer;
    var lat = layer.getLatLng().lat.toFixed(4);
    var lng = layer.getLatLng().lng.toFixed(4);
    var html = template({lat: lat, lng: lng});
    BootstrapDialog.show({
      title: "Data Report",
      message: $(html)
    });

    drawnItems.addLayer(layer);
		});

  var base = new Firebase('https://mapboxexample.firebaseio.com/')

  </script>

<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
<script src="http://nakupanda.github.io/bootstrap3-dialog/assets/bootstrap-dialog/js/bootstrap-dialog.min.js"></script>

</body>
</html>
